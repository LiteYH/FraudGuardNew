<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Manager Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .info {
            color: blue;
        }
    </style>
</head>
<body>
    <h1>Password Manager Functionality Test</h1>
    
    <div class="test-section">
        <h2>1. Master Password Change Test</h2>
        <p>Go to Profile page → Security Settings → Master Password → Change</p>
        <p class="info">This should open a dialog with current password, new password, and confirm password fields.</p>
        <button class="test-button" onclick="testLocalStorage()">Test localStorage Functionality</button>
        <div id="localStorage-result"></div>
    </div>

    <div class="test-section">
        <h2>2. Export Functionality Test</h2>
        <p>In Password Manager, click the Export button</p>
        <p class="info">This should download a JSON file with your password vault data.</p>
        <button class="test-button" onclick="testExport()">Test Export Data Structure</button>
        <div id="export-result"></div>
    </div>

    <div class="test-section">
        <h2>3. Password Editing Test</h2>
        <p>In Password Manager, click the edit icon (pencil) next to any password</p>
        <p class="info">This should open an edit dialog with all password fields.</p>
        <button class="test-button" onclick="testPasswordData()">Test Password Data Structure</button>
        <div id="password-result"></div>
    </div>

    <div class="test-section">
        <h2>4. Persistence Test</h2>
        <p>Add/edit/delete passwords, then refresh the page</p>
        <p class="info">Changes should persist after page refresh.</p>
        <button class="test-button" onclick="testPersistence()">Test Data Persistence</button>
        <div id="persistence-result"></div>
    </div>

    <script>
        function testLocalStorage() {
            const resultDiv = document.getElementById('localStorage-result');
            try {
                // Test localStorage access
                localStorage.setItem('test-key', 'test-value');
                const testValue = localStorage.getItem('test-key');
                localStorage.removeItem('test-key');
                
                if (testValue === 'test-value') {
                    resultDiv.innerHTML = '<p class="success">✅ localStorage is working correctly</p>';
                } else {
                    resultDiv.innerHTML = '<p class="error">❌ localStorage test failed</p>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">❌ localStorage error: ${error.message}</p>`;
            }
        }

        function testExport() {
            const resultDiv = document.getElementById('export-result');
            try {
                const sampleVaultData = {
                    version: "1.0.0",
                    exportedAt: new Date().toISOString(),
                    walletAddress: "0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6",
                    passwords: [
                        {
                            id: "1",
                            title: "Test Password",
                            username: "testuser",
                            password: "testpass123",
                            url: "https://example.com",
                            notes: "Test note",
                            category: "General",
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString(),
                            zkVerified: true
                        }
                    ],
                    metadata: {
                        totalPasswords: 1,
                        categories: { "General": 1 },
                        zkLoginEnabled: true
                    }
                };

                const blob = new Blob([JSON.stringify(sampleVaultData, null, 2)], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                
                resultDiv.innerHTML = '<p class="success">✅ Export data structure is valid</p>';
                resultDiv.innerHTML += '<p class="info">Sample export data created successfully</p>';
                
                URL.revokeObjectURL(url);
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">❌ Export test failed: ${error.message}</p>`;
            }
        }

        function testPasswordData() {
            const resultDiv = document.getElementById('password-result');
            try {
                const samplePassword = {
                    id: "1",
                    title: "Test Password",
                    username: "testuser",
                    password: "testpass123",
                    url: "https://example.com",
                    notes: "Test note",
                    category: "General",
                    createdAt: new Date(),
                    updatedAt: new Date(),
                    zkVerified: true
                };

                // Test required fields
                const requiredFields = ['id', 'title', 'username', 'password', 'url', 'notes', 'category'];
                const missingFields = requiredFields.filter(field => !samplePassword[field]);
                
                if (missingFields.length === 0) {
                    resultDiv.innerHTML = '<p class="success">✅ Password data structure is valid</p>';
                    resultDiv.innerHTML += '<p class="info">All required fields are present</p>';
                } else {
                    resultDiv.innerHTML = `<p class="error">❌ Missing fields: ${missingFields.join(', ')}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">❌ Password data test failed: ${error.message}</p>`;
            }
        }

        function testPersistence() {
            const resultDiv = document.getElementById('persistence-result');
            try {
                const testData = {
                    passwords: [
                        {
                            id: "test-1",
                            title: "Test Password",
                            username: "testuser",
                            password: "testpass123",
                            url: "https://example.com",
                            notes: "Test note",
                            category: "General",
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString(),
                            zkVerified: true
                        }
                    ]
                };

                // Save test data
                localStorage.setItem('fraudguard-passwords', JSON.stringify(testData.passwords));
                
                // Read test data
                const storedData = localStorage.getItem('fraudguard-passwords');
                const parsedData = JSON.parse(storedData);
                
                if (parsedData && parsedData.length > 0 && parsedData[0].id === "test-1") {
                    resultDiv.innerHTML = '<p class="success">✅ Data persistence is working correctly</p>';
                    resultDiv.innerHTML += '<p class="info">Data can be saved and retrieved from localStorage</p>';
                } else {
                    resultDiv.innerHTML = '<p class="error">❌ Data persistence test failed</p>';
                }
                
                // Clean up
                localStorage.removeItem('fraudguard-passwords');
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">❌ Persistence test failed: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>


